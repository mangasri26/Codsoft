import tkinter as tk
from tkinter import ttk, messagebox
import sqlite3 as sql
def add_task():
    task_string = task_field.get().strip()
    if not task_string:
        messagebox.showerror("Error", "Task field is empty!")
        return
    if task_string in tasks:
        messagebox.showwarning("Warning", "Task already exists!")
        return
    tasks.append(task_string)
    the_cursor.execute("INSERT INTO tasks(title) VALUES (?)", (task_string,))
    the_connection.commit()
    list_update()
    task_field.delete(0, tk.END)
def list_update():
    clear_list()
    for task in tasks:
        task_listbox.insert(tk.END, task)
def delete_task():
    try:
        selected_index = task_listbox.curselection()[0]
        task = task_listbox.get(selected_index)
        tasks.remove(task)
        the_cursor.execute("DELETE FROM tasks WHERE title = ?", (task,))
        the_connection.commit()
        list_update()
    except IndexError:
        messagebox.showerror("Error", "No task selected!")
def delete_all_tasks():
    if messagebox.askyesno("Delete All", "Are you sure you want to delete all tasks?"):
        tasks.clear()
        the_cursor.execute("DELETE FROM tasks")
        the_connection.commit()
        list_update()
def clear_list():
    task_listbox.delete(0, tk.END)
def close_app():
    the_connection.commit()
    the_cursor.close()
    the_connection.close()
    guiWindow.destroy()
def retrieve_database():
    tasks.clear()
    for row in the_cursor.execute("SELECT title FROM tasks"):
        tasks.append(row[0])
guiWindow = tk.Tk()
guiWindow.title("To-Do List Manager")
guiWindow.geometry("500x450")
guiWindow.resizable(False, False)
guiWindow.configure(bg="#FAEBD7")
the_connection = sql.connect("listOfTasks.db")
the_cursor = the_connection.cursor()
the_cursor.execute("""
CREATE TABLE IF NOT EXISTS tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT UNIQUE
)
""")
the_connection.commit()
tasks = []
header_frame = tk.Frame(guiWindow, bg="light pink")
functions_frame = tk.Frame(guiWindow, bg="light pink")
listbox_frame = tk.Frame(guiWindow, bg="light pink")
header_frame.pack(fill="both")
functions_frame.pack(side="left", expand=True, fill="both")
listbox_frame.pack(side="right", expand=True, fill="both")
header_label = ttk.Label(
    header_frame,
    text="To-Do List",
    font=("time new romans", 16, "bold"),
    background="light pink",
    foreground="white"
)
header_label.pack(pady=12)
task_label = ttk.Label(
    functions_frame,
    text="Enter the Task:",
    font=("time new romans", 11, "bold"),
    background="light pink",
    foreground="white"
)
task_label.place(x=35, y=45)
task_field = ttk.Entry(functions_frame, font=("Consolas", 12), width=20)
task_field.place(x=40, y=90)
add_button = ttk.Button(
    functions_frame,
    text="Add Task",
    width=26,
    command=add_task
)
del_button = ttk.Button(
    functions_frame,
    text="Delete Task",
    width=26,
    command=delete_task
)
del_all_button = ttk.Button(
    functions_frame,
    text="Delete All",
    width=26,
    command=delete_all_tasks
)
exit_button = ttk.Button(
    functions_frame,
    text="Exit",
    width=24,
    command=close_app
)
add_button.place(x=40, y=140)
del_button.place(x=40, y=180)
del_all_button.place(x=40, y=220)
exit_button.place(x=40, y=260)
task_listbox = tk.Listbox(
    listbox_frame,
    width=24,
    height=11,
    selectmode=tk.SINGLE,
    bg="white",
    fg="black",
    selectbackground="#8A00D3",
    selectforeground="white"
)
task_listbox.place(x=20, y=30)
retrieve_database()
list_update()
guiWindow.mainloop()
